# 架构基础知识

从无到有的是架构；从表到里的是抽象；从粗到细的是设计。

## 架构分类

目前软件架构有三种架构类型，分别是业务架构、应用架构、技术架构。它们之间的关系是业务架构决定应用架构，技术架构支撑应用架构，
架构的发展是从单体架构、分布式架构、SOA架构再到微服务架构。

- 单体架构

  单体架构再java领域可以理解为一个java web应用程序。

- 分布式架构

  什么是传统的分布式架构？简单来说就是按照业务垂直划分，每个应用都是个单体架构，应用之间通过API相互调用。

- 面向服务的SOA架构

  面向服务架构，它可以根据需求通过网络对松散耦合的粗粒度应用组件进行分布式部署、组合和使用。服务层是SOA的基础，可以直接被应用调用，从而有效控制系统中与软件代理交互的人为依赖性。阿里开元的Dubbo是SOA的经典实现。

- 微服务架构

  微服务架构是SOA架构的进一步发展

单体应用拆分为微服务之后所面临的问题：、

1、单体应用拆分为分布式系统后，进程间的通信机制和故障处理措施变得更加复杂。（RPC RESTful调用来解决）
2、系统微服务化后，一个看似简单的功能，内部可能需要调用多个服务并操作多个数据库实现，服务调用的分布式事务问题变的非常突出。
3、微服务数量众多，其测试、部署、监控等都变得更加困难。（docker、Devops技术的发展）

## 什么是Spring Cloud

中间件向下屏蔽异构的硬件、软件、网络等计算资源，向上提供应用开发、运行、维护等全生命周期的统一计算环境与管理，属于承上启下的中间连接层。 中间件本质上可以归属为技术架构，常见的中间件分别是服务治理中间件（例如：Dubbo等RPC框架）、配置中心、全链路监控、分布式事务、分布式定时任务、消息中间件、API网关、分布式缓存、数据库中间件等。

Spring Cloud是一个开源的项目集合，包含很多的子项目，提供了一套完整的微服务解决方案，基于Spring Boot开发，包含了服务注册与发现、配置中心、全链路监控、API网关、熔断器等选型中立的组件，可以根据需求替换组装和扩展。

Spring Cloud 组件列表：

| 组件名称 | 所属项目               | 组件分类         |
| -------- | ---------------------- | ---------------- |
| Eureka   | spring-cloud-netflix   | 注册中心         |
| Zuul     | spring-cloud-netflix   | 第一代网关       |
| Sidecar  | spring-cloud-netflix   | 多语言           |
| Ribbon   | spring-cloud-netflix   | 负载均衡         |
| Hystrix  | spring-cloud-netflix   | 熔断器           |
| Turbine  | spring-cloud-netflix   | 集群监控         |
| Feign    | spring-cloud-openfeign | 声明式HTTP客户端 |
| Consul   | spring-cloud-consul    | 注册中心         |
| Gateway  | spring-cloud-gateway   | 第二代网关       |
| Sleuth   | spring-cloud-sleuth    | 链路追踪         |
| Config   | spring-cloud-config    | 配置中心         |
| Bus      | spring-cloud-bus       | 总线             |
| Pipeline | spring-cloud-pipelines | 部署管道         |
| dataflow | spring-cloud-dataflow  | 数据处理         |

- ### 注册中心

  注册中心可以说是微服务架构中的”通讯录“，它记录了服务和服务地址的映射关系。在分布式架构中，服务会注册到这里，当服务需要调用其它服务时，就到这里找到服务的地址，进行调用。

- ### 配置中心

  集中式配置是将应用系统中对配置信息的管理作为一个新的应用功能模块，区别与传统的配置信息分散到系统各个角落方式，进行集中统一管理，并且提供额外功能。尤其是在微服务架构中，是不可或缺组件，甚至是必要组件之一。

  在微服务体系中，服务的数量以及配置信息的日益增多，比如各种服务器参数配置、各种数据库访问参数配置、各种环境下配置信息的不同、配置信息修改之后实时生效等等，传统的配置文件方式或者将配置信息存放于数据库中的方式已无法满足开发人员对配置管理的要求，如：

  安全性：配置跟随源代码保存在代码库中，容易造成配置泄漏
  时效性：修改配置，需要重启服务才能生效
  局限性：无法支持动态调整：例如日志开关、功能开关
  
- ### 网关中间件

  API Gateway(APIGW/API网关)，随着微服务架构概念的提出，API网关成为微服务架构的一个标配组件，作为一个网关中间件，需要具备如下的功能：
  1、统一接入功能
  	为各种无线应用提供统一的接入服务，提供一个高性能、高并发、高可用的网关服务。不仅如此还要支持负载均衡、容灾切换和异地多活（容灾切换和异地多活怎么实现？）。
  2、协议适配功能
  	网关对外的请求协议一般是HTTP或者HTTP2协议，而后端提供访问的服务协议要么是REST协议要么是RPC协议。网关需要根据请求进来的协议进行协议适配，然后协议转发调用不通协议的服务。
  3、流量管控
  	网关作为所有请求流量的入口，当请求流量瞬间剧增，流量会迅速剧增，此时需要进行流量管控。当后端服务出现异常服务不可用时，需要网关进行熔断和服务降级。在异地多活场景中需要根据请求流量进行分片，路由到不同的机房。
  4、安全防护保护
  	网关需要对所有请求进行安全防护过滤，保护后端服务。通过与安全风控部门合作，对IP黑名单URL黑名单封禁控制，放恶意攻击等。

- ### 全链路监控中间件

  中大型互联网公司的后台业务系统都是由众多的分布式应用组成。一个通过浏览器或移动客户端的前端请求到后端服务应用，会经过很多的应用系统，并且留下足迹和相关的日志信息。但这些分散在每个业务应用主机下的日志信息不利于问题的排查和定位问题发生的根本原因。因此需要利用全链路监控中间件收集、汇总并分析日志信息，进行可视化展示和监控告警。全链路监控中间件应该提供的主要空能包括：
  1、定位慢调用：包括慢Web服务、慢REST或RPC服务、慢SQL
  2、定位各种错误：包括4xx 、5xx、Service Error
  3、定位各种异常：包括Error Exception
  4、展现依赖和拓扑：域拓扑、服务拓扑、trace拓扑
  5、Trace调用链：将端到端的调用，以及附加在这次调用的上下文信息，异常日志信息。每个调用点的耗时呈现给用户进行展示
  6、应用告警：根据运维设定的告警规则，扫描指标数据，如违反告警规则，则将告警信息上报到中央告警平台。

